<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video to Thumbnail with Playbutton</title>
  </head>
  <body>
    <div style="text-align: center">
      <h1>Video to Thumbnail with Playbutton</h1>
      <h3>
        동영상 장면을 선택해 재생 버튼이 첨부된 이미지로 변환하는 프로그램
      </h3>
      <h2>
        Select a scene from the video and save it as an image with a play button
        attached and use it as a thumbnail.
      </h2>
      <h4>
        동영상의 장면을 선택하여 재생 버튼이 첨부된 이미지로 저장하고 썸네일로
        활용하세요.
      </h4>
      <hr />
      <input
        id="file"
        type="file"
        accept="video/mp4,video/mkv, video/x-m4v,video/*"
        style="margin: 10px"
      />
      <br />
      <video
        id="video"
        width="50%"
        controls="true"
        crossorigin="anonymous"
        style="margin: 10px"
      ></video>
      <br />
      <button
        style="
          margin: 10px;
          font-size: 20px;
          padding: 10px;
          border-radius: 10px;
        "
        onclick="shoot()"
      >
        2. Capture
      </button>
      <div id="output" style="margin: 10px"></div>
      <br />
      <button
        style="
          margin: 10px;
          font-size: 20px;
          padding: 10px;
          border-radius: 10px;
        "
        class="download"
        onclick="download()"
      >
        3. Download Image
      </button>
    </div>

    <script>
      const inputFile = document.getElementById('file');
      const video = document.getElementById('video');

      inputFile.addEventListener('change', function () {
        const file = inputFile.files[0];
        const videourl = URL.createObjectURL(file);
        video.setAttribute('src', videourl);
      });

      const videoId = 'video';
      const scaleFactor = 1;

      const buttonSize = 60;
      const playButton = new Image();
      playButton.src = 'play.png';

      function capture(video, scaleFactor) {
        if (scaleFactor == null) {
          scaleFactor = 1;
        }
        const canvas = document.createElement('canvas');
        canvas.classList.add('myCanvas');
        canvas.width = video.videoWidth * scaleFactor;
        canvas.height = video.videoHeight * scaleFactor;

        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        ctx.drawImage(
          playButton,
          canvas.width / 2 - buttonSize / 2,
          canvas.height / 2 - buttonSize / 2,
          buttonSize,
          buttonSize
        );

        return canvas;
      }

      function shoot() {
        var video = document.getElementById(videoId);
        var output = document.getElementById('output');
        var canvas = capture(video, scaleFactor);

        output.innerHTML = '';
        output.appendChild(canvas);
      }

      function download() {
        var image = document.querySelector('.myCanvas').toDataURL();
        const link = document.createElement('a');
        link.href = image;
        link.download = 'thumbnail-with-playbutton';
        link.click();
      }
    </script>
  </body>
</html>
